- title 'Person'
%section.box.show.refugee{ class: @refugee.ekb? ? 'ekb' : '' }
  %h1.box-title
    = "#{@refugee.name}, #{@refugee.dossier_number}"
    = @refugee.draft? ? '(Utkast)' : ''

  .box-content.basic.form-data
    .tabs
      %ul
        %li.active Allmänt
        %li= link_to 'Placeringar', refugee_show_placements_path(@refugee)
        %li= link_to 'Extra kostnader/insatser', refugee_show_costs_path(@refugee)
        %li= link_to 'Anhöriga', refugee_show_relateds_path(@refugee)
        %li= link_to 'Ekonomi', refugee_show_economy_path(@refugee)
    .form-group
      - if @refugee.secrecy?
        .secrecy= 'Sekretess'

    = form_for @refugee, html: { class: 'basic' } do
      = kv 'refugee.updated_at', @refugee.updated_at.to_s[0..18]
      - if current_user.has_role? :admin
        = kv 'refugee.sof_placement', @refugee.sof_placement ? 'Ja' : 'Nej'
      = kv 'refugee.ekb', @refugee.ekb ? 'Ja' : 'Nej'
      = kv 'refugee.arrival', @refugee.arrival ? 'Ja' : 'Nej'
      = kv @refugee, :name
      = kv @refugee, :ssn
      .ekb-only= kv @refugee, :dossier_number
      = kv 'refugee.current_placement',
           @refugee.placements.where(moved_out_at: nil).map(&:home).map(&:name).join(', ')
      = kv 'refugee.current_asylum', asylum_status(@refugee)

      %h2.group-title Personuppgifter
      = kv @refugee, :ssn
      .ekb-only= kv 'refugee.extra_ssns', @refugee.ssns.map(&:full_ssn).join('<br>')

      .ekb-only= kv @refugee, :dossier_number
      .ekb-only= kv 'refugee.dossier_numbers', @refugee.dossier_numbers.map(&:name).join('<br>')
      .form-group
        .control-label{ popover('refugee.procapita') }= I18n.t('simple_form.labels.refugee.procapita')
        .controls= @refugee.procapita
      = kv @refugee, :age

      = kv 'refugee.gender', @refugee.gender.present? ? @refugee.gender.name : 'Ej angivet'

      = kv 'refugee.languages', @refugee.languages.map(&:name).join(', ')
      = kv 'refugee.countries', @refugee.countries.map(&:name).join(', ')
      .ekb-only= kv 'refugee.special_needs', @refugee.special_needs ? 'Ja' : 'Nej'
      = kv @refugee, :social_worker

      %h2.group-title Status
      = kv @refugee, :registered
      .ekb-only= kv @refugee, :residence_permit_at
      .ekb-only= kv @refugee, :checked_out_to_our_city
      .ekb-only= kv @refugee, :temporary_permit_starts_at
      .ekb-only= kv @refugee, :temporary_permit_ends_at
      .ekb-only= kv @refugee, :citizenship_at
      = kv 'refugee.municipality',
        @refugee.municipality.present? ? @refugee.municipality.name : 'Ingen'
      .ekb-only= kv 'refugee.transferred', @refugee.transferred? ? 'Ja' : 'Nej'
      .ekb-only= kv @refugee, :municipality_placement_migrationsverket_at
      .ekb-only= kv @refugee, :municipality_placement_comment
      = kv @refugee, :deregistered
      .ekb-only= kv 'refugee.deregistered_reason',
        @refugee.deregistered_reason.present? ? @refugee.deregistered_reason.name : ''
      .ekb-only= kv @refugee, :deregistered_comment

      .form-group
        - if can? :edit, @refugee
          = link_to 'Redigera', edit_refugee_path(@refugee), class: 'btn btn-default'
